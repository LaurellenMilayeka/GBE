#include "BIOS.hpp"

uint8_t Engine::BIOS::_nintendoBIOSVerification[48] = {

  0xCE, 0xED, 0x66, 0x66, 0xCC, 0x0D, 0x00, 0x0B, 0x03, 0x73, 0x00, 0x83, 0x00, 0x0C, 0x00, 0x0D,
  0x00, 0x08, 0x11, 0x1F, 0x88, 0x89, 0x00, 0x0E, 0xDC, 0xCC, 0x6E, 0xE6, 0xDD, 0xDD, 0xD9, 0x99,
  0xBB, 0xBB, 0x67, 0x63, 0x6E, 0x0E, 0xEC, 0xCC, 0xDD, 0xDC, 0x99, 0x9F, 0xBB, 0xB9, 0x33, 0x3E
};

void Engine::BIOS::CheckBIOSIntegrity() {

  bool success = true;
  uint16_t pos = 0x104;
  
  DEBUG_PRINT("Checking BIOS integrity");
  while (pos <= 0x133 && success) {
    if (_nintendoBIOSVerification[pos - 0x104] != Engine::RAM::GetByte(pos)) {
      success = false;
    } else {
      pos++;
    }
  }
  if (!success) {
    std::cerr << "[ERROR] : Cartridge BIOS is not matching the system's one" << std::endl;
    DEBUG_PRINT(std::hex << Engine::RAM::GetByte(pos) << " is different from " << std::hex << _nintendoBIOSVerification[pos - 0x104]);
  } else {
    std::cout << "[INFO] : BIOS integrity checked" << std::endl;
  }
}
